# 客服坐席后台使用说明

## 访问方式

客服后台是独立的管理界面，通过 URL 参数访问：

**客服后台地址**: `http://localhost:5173/?mode=agent`

**客户界面地址**: `http://localhost:5173/` (默认)

## 功能特性

### 1. 会话列表管理
- 查看所有会话（活跃和已关闭）
- 实时更新会话列表
- 搜索会话功能
- 显示会话状态和最后更新时间

### 2. 消息查看和回复
- 查看会话中的所有消息
- 实时接收新消息（使用 Supabase Realtime）
- 发送客服回复
- 消息按时间顺序显示

### 3. 会话状态管理
- 关闭会话（将状态改为 'closed'）
- 重新打开已关闭的会话
- 实时同步会话状态

## 使用流程

1. **访问客服后台**
   - 在浏览器地址栏输入: `http://localhost:5173/?mode=agent`

2. **查看会话列表**
   - 左侧显示所有会话
   - 绿色标签表示"进行中"
   - 灰色标签表示"已关闭"

3. **选择会话**
   - 点击左侧会话卡片查看详情
   - 右侧显示该会话的所有消息

4. **回复客户**
   - 在底部输入框输入回复内容
   - 点击"发送"按钮或按 Enter 键发送
   - 已关闭的会话无法发送消息

5. **管理会话**
   - 点击会话卡片上的 ❌ 按钮关闭会话
   - 点击已关闭会话的 ✓ 按钮重新打开

## 界面说明

### 左侧面板
- **搜索框**: 可以搜索会话ID
- **会话列表**: 显示所有会话，包括：
  - 会话ID（前8位）
  - 会话状态（进行中/已关闭）
  - 最后更新时间
  - 操作按钮（关闭/打开）

### 右侧面板
- **会话详情**: 显示选中会话的ID和状态
- **消息列表**: 显示该会话的所有消息
  - 客户消息：左侧显示，白色背景
  - 客服消息：右侧显示，蓝色背景
- **回复输入框**: 输入和发送回复消息

## 实时功能

- ✅ 新消息自动推送到客服后台
- ✅ 会话状态变化实时更新
- ✅ 无需刷新页面即可看到最新消息

## 注意事项

1. **权限控制**: 当前所有用户都可以访问客服后台，生产环境建议添加身份验证
2. **会话关闭**: 关闭会话后，客户和客服都无法发送新消息
3. **消息历史**: 所有消息都会保存在数据库中，可以随时查看

## 安全建议

在生产环境中，建议：

1. 添加登录验证，只有授权客服才能访问后台
2. 配置 Supabase RLS 策略，限制数据访问权限
3. 使用 Service Role Key 进行服务端操作
4. 记录客服操作日志

## 技术实现

- 使用 Supabase Realtime 实现实时消息同步
- 使用 React Hooks 管理状态
- 使用 Motion 实现动画效果
- 响应式设计，支持不同屏幕尺寸

